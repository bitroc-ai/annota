# Annota

A high-performance React annotation framework for digital pathology and whole slide imaging.

## What is Annota?

Annota is a modern annotation library built specifically for medical imaging applications. It combines the power of OpenSeadragon for gigapixel image viewing with PixiJS for hardware-accelerated rendering, delivering smooth performance even with thousands of annotations.

## Key Features

### High Performance
- **Hardware-Accelerated Rendering**: PixiJS WebGL rendering for smooth, responsive annotations
- **Viewport Culling**: Only renders annotations visible in the current viewport
- **Level of Detail (LOD)**: Automatically simplifies rendering when zoomed out
- **Smart Caching**: Graphics only re-rendered when necessary
- **R-tree Spatial Indexing**: Fast spatial queries for hit testing and selection

### Purpose-Built for Pathology
- **Point Markers**: Mark cells, nuclei, or regions of interest
- **Rectangles**: Define bounding boxes for regions
- **Polygons**: Trace complex boundaries
- **Contours**: Automatic contour detection for segmentation masks
- **Push Tool**: Interactive push/pull editing for natural annotation workflows

### Event-Driven Architecture
- **Lifecycle Events**: Listen to `createAnnotation`, `updateAnnotation`, `deleteAnnotation`, `selectionChanged`
- **Programmatic Control**: Full API for managing annotations from code
- **Selection Management**: Built-in selection with multi-select support

### Multi-Layer Organization
- **Independent Layers**: Organize annotations into logical groups
- **Layer Controls**: Toggle visibility, adjust opacity, lock layers
- **Z-Index Management**: Control rendering order
- **Per-Layer Styling**: Apply consistent styles across annotation groups

### Flexible Data Loading
- **H5 Masks**: Load segmentation masks from HDF5 files
- **H5 Coordinates**: Load point annotations from coordinate datasets
- **JSON Format**: Standard annotation interchange format
- **PGM Files**: Legacy mask format support

### React First
- **Modern Hooks API**: Intuitive hooks for annotations, selection, layers, and tools
- **Type-Safe**: Full TypeScript support with comprehensive type definitions
- **Component-Based**: Pre-built components for common workflows

## Quick Start

```tsx
import { AnnotaProvider, AnnotaViewer, Annotator, useAnnotator } from 'annota';
import { PointTool } from 'annota';
import { useState } from 'react';
import 'annota/dist/index.css';

function App() {
  return (
    <AnnotaProvider slideId="slide-123">
      <AnnotationViewer />
    </AnnotaProvider>
  );
}

function AnnotationViewer() {
  const [viewer, setViewer] = useState(null);
  const annotator = useAnnotator();

  return (
    <div style={{ width: '100vw', height: '100vh' }}>
      <AnnotaViewer
        options={{
          tileSources: '/path/to/image.dzi',
          prefixUrl: 'https://cdn.jsdelivr.net/npm/openseadragon@4/build/openseadragon/images/',
        }}
        onViewerReady={(osdViewer) => {
          setViewer(osdViewer);
        }}
      />
      <Annotator viewer={viewer} />
    </div>
  );
}
```

## Use Cases

Annota is designed for:

- **Digital Pathology**: Annotate regions of interest in whole slide images
- **AI Training**: Create and manage training datasets for machine learning models
- **Clinical Workflows**: Support pathologist workflows with annotation tools
- **Research**: Facilitate research with flexible annotation capabilities
- **Cell Counting**: Mark and count cells with point annotations
- **Tumor Segmentation**: Trace tumor boundaries with polygons

## Architecture

Annota follows a clean, layered architecture separating concerns:

```
┌─────────────────────────────────────┐
│   React Components & Hooks          │
│   - AnnotaProvider, Viewer          │
│   - useAnnotator, useTool, etc.     │
├─────────────────────────────────────┤
│   Core Annotation Engine            │
│   - Store (Observable)              │
│   - Spatial Index (R-tree)          │
│   - Layer Manager                   │
│   - Event Emitter                   │
├─────────────────────────────────────┤
│   Rendering Engine (PixiJS)         │
│   - Viewport Culling                │
│   - Level of Detail (LOD)           │
│   - Smart Caching                   │
├─────────────────────────────────────┤
│   OpenSeadragon Adapter             │
│   - Viewport Integration            │
│   - Coordinate Transform            │
│   - Event Handling                  │
└─────────────────────────────────────┘
```

## Next Steps

- [Get Started](/docs/getting-started) - Install and set up Annota
- [Guides](/docs/guides) - Learn how to use annotation tools, layers, and events
- [API Reference](/api) - Detailed API documentation
- [Examples](/docs/examples) - Practical examples and use cases
- [Playground](/playground) - Try Annota in an interactive environment

## Performance

Annota is optimized for large-scale medical imaging:

- ✅ Handles **10,000+ annotations** smoothly
- ✅ **60 FPS** rendering during pan/zoom
- ✅ **Sub-millisecond** hit testing with R-tree indexing
- ✅ **Automatic optimization** with viewport culling and LOD
- ✅ **Perfect sync** with OpenSeadragon viewport updates

## Community & Support

- **GitHub**: [bitroc-ai/annota](https://github.com/bitroc-ai/annota)
- **npm**: [annota](https://www.npmjs.com/package/annota)
- **Issues**: [Report bugs or request features](https://github.com/bitroc-ai/annota/issues)

## License

MIT © BitRoc Lab
