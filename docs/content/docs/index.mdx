import { Cards, Callout, Steps } from "nextra/components";
import {
  Zap,
  Palette,
  Plug,
  Layers,
  Database,
  Atom,
  BookOpen,
  GraduationCap,
  FileText,
  Lightbulb,
  Gamepad2,
  Building,
} from "lucide-react";
import { ExampleViewer } from "@/components/examples";

# Introduction

Annota is a **high-performance annotation framework** designed specifically for whole slide imaging (WSI) and digital pathology applications. Built with TypeScript and React, it provides a comprehensive solution for creating, editing, and managing annotations on large-scale medical images.

<Callout type="info">
  **Performance at Scale**: Annota handles over 10,000 annotations at 60 FPS
  with hardware-accelerated rendering, viewport culling, and R-tree spatial
  indexing.
</Callout>

## Why Annota?

<Cards num={3}>
  <Cards.Card
    icon={<Zap />}
    title="High Performance"
    href="/docs/guides/tools"
  />
  <Cards.Card
    icon={<Palette />}
    title="Purpose-Built for Pathology"
    href="/docs/guides/tools"
  />
  <Cards.Card
    icon={<Plug />}
    title="Event-Driven Architecture"
    href="/docs/guides/events"
  />
  <Cards.Card
    icon={<Layers />}
    title="Multi-Layer Organization"
    href="/docs/guides/layers"
  />
  <Cards.Card
    icon={<Database />}
    title="Flexible Data Loading"
    href="/docs/guides/loaders"
  />
  <Cards.Card icon={<Atom />} title="React First" href="/api/hooks" />
</Cards>

## Try It Now

**Interactive Demo**: Click and drag to draw a rectangle annotation, or select and resize the existing one.

<ExampleViewer type="rectangle" height={500} />

<Callout>
  This is a fully interactive annotation viewer. You can create, select, move, and resize annotations in real-time. The same viewer powers production pathology workflows.
</Callout>

## Quick Start

<Steps>

### Install Annota

```bash
npm install annota openseadragon
# or
pnpm add annota openseadragon
```

### Create Your First Viewer

```tsx
import { AnnotaProvider, AnnotaViewer, Annotator } from "annota";
import { useState } from "react";
import "annota/dist/index.css";

function App() {
  const [viewer, setViewer] = useState(null);

  return (
    <AnnotaProvider slideId="slide-001">
      <div style={{ width: "100vw", height: "100vh" }}>
        <AnnotaViewer
          options={{
            tileSources: "/path/to/image.dzi",
            prefixUrl:
              "https://cdn.jsdelivr.net/npm/openseadragon@4/build/openseadragon/images/",
          }}
          onViewerReady={setViewer}
        />
        <Annotator viewer={viewer} />
      </div>
    </AnnotaProvider>
  );
}
```

### Add Annotation Tools

```tsx
import { useTool, PointTool, PolygonTool } from "annota";

const pointTool = new PointTool();
const polygonTool = new PolygonTool();

useTool({ viewer, handler: pointTool, enabled: true });
```

</Steps>

<Callout type="success">
  **Ready to go!** You now have a working annotation viewer. [See full examples
  â†’](/docs/use-cases/basic-viewer)
</Callout>

## Key Features

### Performance

Annota is optimized for large-scale medical imaging with advanced rendering techniques:

- **ðŸš€ Viewport Culling**: Only renders annotations visible in the current viewport
- **ðŸ“Š Level of Detail (LOD)**: Automatically simplifies rendering when zoomed out
- **ðŸ’¾ Smart Caching**: Graphics only re-rendered when state, LOD, or scale changes significantly
- **ðŸŒ³ R-tree Spatial Indexing**: Sub-millisecond hit testing and spatial queries
- **âš¡ Hardware Acceleration**: PixiJS WebGL rendering for 60 FPS performance

<Callout type="info">
  **Performance Metrics**: Handles over 10,000 annotations smoothly with 60 FPS
  during pan/zoom operations.
</Callout>

### Annotation Tools

Comprehensive set of tools for medical image annotation:

| Tool              | Purpose                         | Interaction                            |
| ----------------- | ------------------------------- | -------------------------------------- |
| **PointTool**     | Cell counting, nuclei detection | Single click                           |
| **RectangleTool** | Bounding boxes, ROI selection   | Click and drag                         |
| **PolygonTool**   | Tumor boundaries, segmentation  | Click vertices, double-click to finish |
| **PushTool**      | Refine polygon boundaries       | Click and drag to push/pull vertices   |
| **ContourTool**   | Automatic contour detection     | Click to detect from masks             |

[Learn more about tools â†’](/docs/guides/tools)

### Event System

React to annotation changes with a comprehensive event system:

```tsx
annotator.on("createAnnotation", (annotation) => {
  console.log("Annotation created:", annotation);
});

annotator.on("updateAnnotation", (annotation) => {
  console.log("Annotation updated:", annotation);
});

annotator.on("deleteAnnotation", (annotation) => {
  console.log("Annotation deleted:", annotation);
});

annotator.on("selectionChanged", ({ selected }) => {
  console.log("Selection changed:", selected);
});
```

[Explore event handling â†’](/docs/guides/events)

### Layer System

Organize annotations into multiple layers with independent controls:

- **Visibility**: Toggle layer visibility on/off
- **Opacity**: Adjust layer transparency (0-1)
- **Locking**: Prevent editing of specific layers
- **Z-Index**: Control rendering order
- **Per-Layer Styling**: Apply consistent styles across layers

[Master layer management â†’](/docs/guides/layers)

### Data Loaders

Import annotations from various file formats:

```tsx
// Load H5 mask annotations
const maskAnnotations = await loadH5Masks("/annotations/masks.h5", {
  color: "#FF0000",
  fillOpacity: 0.3,
});

// Load H5 point coordinates
const pointAnnotations = await loadH5Coordinates("/annotations/cells.h5", {
  color: "#00FF00",
  fillOpacity: 0.8,
});
```

**Supported formats**: H5 masks, H5 coordinates, JSON, PGM

[Data loading guide â†’](/docs/guides/loaders)

### React Integration

Modern React hooks for seamless integration:

```tsx
import {
  useAnnotations, // Get all annotations
  useAnnotation, // Get specific annotation
  useSelection, // Access selected annotations
  useTool, // Activate annotation tool
  useLayerManager, // Manage layers
  useAnnotator, // Access annotator instance
} from "annota";
```

Full TypeScript support with comprehensive type definitions.

[Explore React hooks â†’](/api/hooks)

## Architecture

Annota follows a clean, layered architecture separating concerns:

```mermaid
graph TB
    subgraph React["React Layer"]
        Components["Components & Hooks<br/>AnnotaProvider, Viewer<br/>useAnnotator, useTool"]
    end

    subgraph Core["Core Engine"]
        Store["Observable Store"] ~~~ Spatial["R-tree Index"] ~~~ Layers["Layer Manager"] ~~~ Events["Event Emitter"]
    end

    subgraph Rendering["Rendering Engine"]
        PixiJS["PixiJS WebGL"] ~~~ Culling["Viewport Culling"] ~~~ LOD["Level of Detail"] ~~~ Cache["Smart Caching"]
    end

    subgraph Adapter["OpenSeadragon Adapter"]
        Viewport["Viewport Integration"] ~~~ Transform["Coordinate Transform"] ~~~ EventHandling["Event Handling"]
    end

    Components --> Core
    Core --> Rendering
    Rendering --> Adapter
```

<Callout>
  The architecture separates concerns into four distinct layers, each with
  specific responsibilities. This design enables high performance,
  maintainability, and extensibility.
</Callout>

[Learn more about the architecture â†’](/docs/architecture)

## Next Steps

<Cards num={3}>
  <Cards.Card
    icon={<BookOpen />}
    title="Getting Started"
    href="/docs/getting-started"
  />
  <Cards.Card
    icon={<GraduationCap />}
    title="Guides"
    href="/docs/guides/tools"
  />
  <Cards.Card icon={<FileText />} title="API" href="/api" />
  <Cards.Card
    icon={<Lightbulb />}
    title="Use Cases"
    href="/docs/use-cases/basic-viewer"
  />
  <Cards.Card icon={<Gamepad2 />} title="Playground" href="/playground" />
  <Cards.Card
    icon={<Building />}
    title="Architecture"
    href="/docs/architecture"
  />
</Cards>

<Callout type="warning">
  **Need Help?** Check out our [GitHub
  repository](https://github.com/bitroc-ai/annota) or open an
  [issue](https://github.com/bitroc-ai/annota/issues) for support.
</Callout>
