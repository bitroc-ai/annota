# Advanced Features

## Roadmap & Future Development

Annota is actively under development with the following features planned or in progress.

### Phase 1: Core Shape Support ✅ COMPLETED

- [x] Point annotations
- [x] Circle annotations
- [x] Ellipse annotations
- [x] Rectangle annotations
- [x] Line annotations
- [x] Polygon annotations
- [x] Freehand/polyline annotations
- [x] Multi-polygon support
- [x] PixiJS rendering for all shapes

### Phase 2: Drawing Tools (IN PROGRESS)

- [ ] Freehand drawing tool (mouse drag to draw)
- [ ] Polygon drawing tool (click to add points, double-click to finish)
- [ ] Rectangle tool (drag to create)
- [ ] Ellipse tool (drag to create)
- [ ] Line tool (click start, click end)
- [ ] Simplify freehand paths (Douglas-Peucker algorithm)
- [ ] Smooth freehand paths (Bezier curve fitting)

### Phase 3: Selection & Editing

- [ ] Click to select annotation
- [ ] Hover highlighting
- [ ] Multi-select (Shift+click or drag box)
- [ ] Move selected annotations (drag)
- [ ] Resize annotations (drag handles)
- [ ] Rotate annotations (for ellipse)
- [ ] Delete selected (Delete key)
- [ ] Undo/Redo system
- [ ] Copy/Paste annotations

### Phase 4: Properties & Classification

- [ ] Annotation properties panel
- [ ] Classification system (cell types, groups)
- [ ] Color coding by classification
- [ ] Custom metadata fields
- [ ] Measurements (area, perimeter, etc.)
- [ ] Statistics panel

### Phase 5: AI & Extensions

- [ ] Extension/Plugin system architecture
- [ ] AI API interface definition
- [ ] OpenCV.js integration for edge detection ✅
- [ ] Threshold adjustment UI
- [ ] Auto-cell detection from click point ✅
- [ ] Edge refinement based on threshold
- [ ] SAM (Segment Anything Model) integration
- [ ] Auto-annotation for selected region
- [ ] Batch processing

### Phase 6: Data Management

- [ ] Export annotations (JSON, H5, GeoJSON)
- [ ] Import annotations (JSON, H5, XML/ASAP)
- [ ] Annotation layers (show/hide groups) ✅
- [ ] Filter annotations by properties
- [ ] Search annotations
- [ ] Annotation history/versioning

### Phase 7: Advanced Features

- [ ] Measurement tools (distance, area, angle)
- [ ] Annotation locking
- [ ] Annotation groups/hierarchies
- [ ] Collaborative annotations
- [ ] Annotation validation workflow
- [ ] Quality control tools

## Extension System (Planned)

### Design Concept

Extensions will provide:

1. **AI Models**: Auto-annotation, segmentation, classification
2. **Tools**: Custom drawing tools
3. **Processors**: Batch processing, validation
4. **Exporters**: Custom export formats

### Extension API (Proposed)

```typescript
interface AnnotaExtension {
  id: string;
  name: string;
  version: string;

  // Lifecycle hooks
  onInit?(annotator: Annotator): void;
  onDestroy?(): void;

  // Tool extensions
  tools?: Tool[];

  // AI capabilities
  detect?(image: ImageData, options: any): Promise<Annotation[]>;
  classify?(annotation: Annotation): Promise<Classification>;
  segment?(point: Point, image: ImageData): Promise<Polygon>;
}
```

### Example Extension

```typescript
const openCVExtension: AnnotaExtension = {
  id: 'opencv-cell-detector',
  name: 'OpenCV Cell Detector',
  version: '1.0.0',

  async onInit(annotator) {
    await initOpenCV();
    console.log('OpenCV extension loaded');
  },

  async segment(point, imageData) {
    const result = await detectCellEdge(imageData, point, {
      threshold: 128,
      thresholdType: 'otsu',
    });

    return result.polygon;
  },
};

// Register extension
annotator.registerExtension(openCVExtension);
```

## Development Principles

1. **Type Safety**: Full TypeScript coverage
2. **Framework Agnostic**: Core logic independent of React/OSD
3. **Performance**: WebGL rendering, spatial indexing
4. **Extensibility**: Plugin system for AI/tools
5. **User Experience**: Intuitive QuPath-like interface
6. **Data Interoperability**: Standard formats (JSON, GeoJSON, H5)

## Contributing

Want to contribute? Check out:

- [GitHub Repository](https://github.com/bitroc/annota)
- [Issues & Feature Requests](https://github.com/bitroc/annota/issues)
- [Pull Requests Welcome](https://github.com/bitroc/annota/pulls)

### Priority Areas

1. **Freehand Drawing Tool** - Most critical for cell tracing
2. **Selection System** - Required for editing
3. **Basic Editing** - Move, delete
4. **Properties Panel** - Classification & metadata
5. **Extension System** - Framework for AI tools
