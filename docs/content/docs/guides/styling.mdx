# Styling Annotations

Customize the appearance of annotations with flexible styling options.

## Styling Methods

Annota supports three levels of styling:

1. **Default Style** - Global default for all annotations
2. **Per-Annotation Style** - Style stored with each annotation
3. **Dynamic Style Function** - Computed at render time

## Annotation Style Properties

```typescript
interface AnnotationStyle {
  fill?: string; // Fill color (CSS color string)
  fillOpacity?: number; // Fill opacity (0-1)
  stroke?: string; // Stroke color (CSS color string)
  strokeWidth?: number; // Stroke width in image coordinates
  strokeOpacity?: number; // Stroke opacity (0-1)
}
```

## Per-Annotation Styling

Store style directly on the annotation:

```tsx
const annotation = {
  id: 'ann-1',
  shape: { type: 'point', point: { x: 100, y: 100 }, bounds: {...} },
  style: {
    fill: '#FF0000',
    fillOpacity: 0.8,
    stroke: '#FFFFFF',
    strokeWidth: 2,
    strokeOpacity: 1.0,
  },
};

annotator.addAnnotation(annotation);
```

### Tool Default Styles

Set default style for tool-created annotations:

```tsx
const pointTool = new PointTool({
  style: {
    fill: "#00FF00",
    fillOpacity: 0.8,
    strokeWidth: 2,
  },
});
```

## Dynamic Style Functions

Compute styles based on annotation properties:

```tsx
<Annotator
  viewer={viewer}
  style={(annotation) => ({
    fill: annotation.properties?.type === "tumor" ? "#FF0000" : "#00FF00",
    fillOpacity: annotation.properties?.confidence || 0.5,
    stroke: "#FFFFFF",
    strokeWidth: 2,
  })}
/>
```

### Category-Based Styling

```tsx
const categoryStyles = {
  tumor: { fill: "#FF0000", fillOpacity: 0.3 },
  healthy: { fill: "#00FF00", fillOpacity: 0.3 },
  uncertain: { fill: "#FFFF00", fillOpacity: 0.3 },
};

<Annotator
  viewer={viewer}
  style={(annotation) => {
    const category = annotation.properties?.category || "uncertain";
    return categoryStyles[category];
  }}
/>;
```

### Confidence-Based Opacity

```tsx
<Annotator
  viewer={viewer}
  style={(annotation) => ({
    fill: "#FF0000",
    fillOpacity: annotation.properties?.confidence || 0.3,
    stroke: "#FFFFFF",
  })}
/>
```

### Selection Highlighting

Highlight selected annotations:

```tsx
function StyledAnnotator({ viewer }) {
  const selection = useSelection();
  const selectedIds = new Set(selection.map((s) => s.id));

  return (
    <Annotator
      viewer={viewer}
      style={(annotation) => ({
        fill: "#FF0000",
        fillOpacity: selectedIds.has(annotation.id) ? 0.6 : 0.3,
        stroke: selectedIds.has(annotation.id) ? "#FFFF00" : "#FFFFFF",
        strokeWidth: selectedIds.has(annotation.id) ? 3 : 2,
      })}
    />
  );
}
```

## Layer-Based Styling

Apply consistent styles to entire layers:

```tsx
const layers = {
  tumor: { fill: "#FF0000", fillOpacity: 0.3 },
  healthy: { fill: "#00FF00", fillOpacity: 0.3 },
};

<Annotator
  viewer={viewer}
  style={(annotation) => {
    const layerId = annotation.properties?.layer || "default";
    return layers[layerId] || { fill: "#CCCCCC", fillOpacity: 0.3 };
  }}
/>;
```

## Color Palettes

### Categorical Colors

```tsx
const colors = ["#E74C3C", "#3498DB", "#2ECC71", "#F39C12", "#9B59B6"];

<Annotator
  viewer={viewer}
  style={(annotation) => {
    const index = parseInt(annotation.id.split("-")[1]) % colors.length;
    return {
      fill: colors[index],
      fillOpacity: 0.3,
    };
  }}
/>;
```

### Heatmap Colors

```tsx
function getHeatmapColor(value: number): string {
  // value between 0-1
  const hue = (1 - value) * 240; // Blue (240) to Red (0)
  return `hsl(${hue}, 100%, 50%)`;
}

<Annotator
  viewer={viewer}
  style={(annotation) => ({
    fill: getHeatmapColor(annotation.properties?.score || 0),
    fillOpacity: 0.5,
  })}
/>;
```

## Interactive Styling

### Hover Effects

Combine with hover state (requires custom implementation):

```tsx
function HoverStyled({ viewer }) {
  const [hoveredId, setHoveredId] = useState<string | null>(null);

  return (
    <Annotator
      viewer={viewer}
      style={(annotation) => ({
        fill: "#FF0000",
        fillOpacity: annotation.id === hoveredId ? 0.8 : 0.3,
        strokeWidth: annotation.id === hoveredId ? 3 : 2,
      })}
      onHover={(id) => setHoveredId(id)}
    />
  );
}
```

## Best Practices

### 1. Use Memoization

For expensive style calculations, use memoization:

```tsx
const styleFunction = useCallback(
  (annotation: Annotation) => {
    // Expensive calculation
    return {
      fill: computeColor(annotation),
      fillOpacity: 0.3,
    };
  },
  [
    /* dependencies */
  ]
);

<Annotator viewer={viewer} style={styleFunction} />;
```

### 2. Consistent Stroke Width

Keep stroke width consistent across zoom levels by using small values:

```tsx
style={{
  strokeWidth: 2,  // ✅ Good - scales with zoom
}}
```

### 3. Sufficient Contrast

Ensure annotations are visible against the image:

```tsx
style={{
  fill: '#FF0000',
  stroke: '#FFFFFF',  // ✅ White stroke for visibility
  strokeWidth: 2,
}}
```

### 4. Accessibility

Use colors that are distinguishable for colorblind users:

```tsx
// ✅ Good palette (colorblind-friendly)
const colors = {
  primary: "#0173B2", // Blue
  secondary: "#DE8F05", // Orange
  tertiary: "#029E73", // Green
};
```

## Examples

### Medical Annotation Styling

```tsx
const medicalStyles = {
  benign: {
    fill: "#2ECC71",
    fillOpacity: 0.25,
    stroke: "#27AE60",
    strokeWidth: 2,
  },
  malignant: {
    fill: "#E74C3C",
    fillOpacity: 0.4,
    stroke: "#C0392B",
    strokeWidth: 3,
  },
  suspicious: {
    fill: "#F39C12",
    fillOpacity: 0.3,
    stroke: "#E67E22",
    strokeWidth: 2,
  },
};

<Annotator
  viewer={viewer}
  style={(annotation) =>
    medicalStyles[annotation.properties?.diagnosis] || medicalStyles.suspicious
  }
/>;
```

### Quality-Based Styling

```tsx
<Annotator
  viewer={viewer}
  style={(annotation) => {
    const quality = annotation.properties?.quality || 0;
    return {
      fill: quality > 0.8 ? "#2ECC71" : quality > 0.5 ? "#F39C12" : "#E74C3C",
      fillOpacity: 0.3,
      strokeWidth: 2,
    };
  }}
/>
```

## Next Steps

- [Layer System](/docs/guides/layers) - Organize annotations with layers
- [Events](/docs/guides/events) - Dynamic styling based on events
- [API](/api/types) - Complete style type definitions
