# React Hooks

React hooks for working with annotations.

## useAnnotations

Get all annotations in the store.

```typescript
function useAnnotations(): Annotation[]
```

**Example:**

```tsx
import { useAnnotations } from 'annota';

function AnnotationList() {
  const annotations = useAnnotations();

  return (
    <ul>
      {annotations.map(ann => (
        <li key={ann.id}>{ann.shape.type}</li>
      ))}
    </ul>
  );
}
```

## useAnnotation

Get a specific annotation by ID.

```typescript
function useAnnotation(id: string): Annotation | undefined
```

**Example:**

```tsx
const annotation = useAnnotation('ann-123');
```

## useSelection

Get currently selected annotations.

```typescript
function useSelection(): Annotation[]
```

**Example:**

```tsx
import { useSelection } from 'annota';

function SelectionInfo() {
  const selection = useSelection();

  return <div>Selected: {selection.length}</div>;
}
```

## usePopup

Manage annotation popup state.

```typescript
interface UsePopupOptions {
  autoShow?: boolean; // Default: false
}

interface UsePopupResult {
  annotation: Annotation | null;
  show: (annotationId: string) => void;
  hide: () => void;
  toggle: (annotationId: string) => void;
  updateProperties: (annotationId: string, properties: Record<string, unknown>) => void;
  updateStyle: (annotationId: string, style: Partial<AnnotationStyle>) => void;
  deleteAnnotation: (annotationId: string) => void;
}

function usePopup(options?: UsePopupOptions): UsePopupResult
```

**Example:**

```tsx
import { usePopup, useAnnotationDoubleClick } from 'annota';

function Editor({ viewer }) {
  const popup = usePopup({ autoShow: false });

  useAnnotationDoubleClick(viewer, annotation => {
    popup.show(annotation.id);
  });

  return (
    <AnnotationPopup
      viewer={viewer}
      annotation={popup.annotation}
      onClose={popup.hide}
    >
      <input
        value={popup.annotation?.properties?.label || ''}
        onChange={(e) =>
          popup.updateProperties(popup.annotation!.id, {
            label: e.target.value,
          })
        }
      />
    </AnnotationPopup>
  );
}
```

## useEditing

Manage vertex editing mode for polygon annotations.

```typescript
interface UseEditingOptions {
  /** Automatically exit editing mode when clicking outside annotation (default: true) */
  exitOnClickOutside?: boolean;
}

interface UseEditingResult {
  editingAnnotation: Annotation | null;
  editingId: string | undefined;
  editMode: 'vertices' | undefined;
  startEditing: (annotationId: string, mode?: 'vertices') => void;
  stopEditing: () => void;
  isEditing: (annotationId: string) => boolean;
}

function useEditing(options?: UseEditingOptions): UseEditingResult
```

**Options:**

- `exitOnClickOutside` (boolean, default: `true`): When enabled, provides smart click behavior:
  - Clicking empty space exits vertex editing mode
  - Clicking the same annotation stays in editing mode
  - Clicking a different annotation switches to editing the new annotation

**Example:**

```tsx
import { useEditing, getEditorConfig } from 'annota';

function Editor({ viewer }) {
  // Click-outside-to-exit is enabled by default
  const { startEditing, stopEditing, isEditing } = useEditing();

  // Or disable it explicitly
  // const { startEditing, stopEditing, isEditing } = useEditing({
  //   exitOnClickOutside: false
  // });

  // Enter vertex editing mode
  const handleEdit = (annotationId: string) => {
    startEditing(annotationId);
  };

  // Exit editing mode
  const handleDone = () => {
    stopEditing();
  };

  return (
    <button onClick={handleDone}>
      Exit Editing
    </button>
  );
}
```

## useAnnotationDoubleClick

Listen for double-click events on annotations.

```typescript
function useAnnotationDoubleClick(
  viewer: OpenSeadragon.Viewer | undefined,
  onDoubleClick: (annotation: Annotation) => void
): void
```

**Example:**

```tsx
import { useAnnotationDoubleClick, useEditing, getEditorConfig } from 'annota';

// Enter vertex editing mode on double-click
const { startEditing } = useEditing();
useAnnotationDoubleClick(viewer, annotation => {
  const editorConfig = getEditorConfig(annotation);
  if (editorConfig?.supportsVertexEditing) {
    startEditing(annotation.id);
  }
});
```

## useLayerManager

Manage annotation layers.

```typescript
interface UseLayerManagerResult {
  layers: Layer[];
  createLayer: (config: LayerConfig) => void;
  updateLayer: (id: string, updates: Partial<Layer>) => void;
  deleteLayer: (id: string, deleteAnnotations?: boolean) => void;
  getLayer: (id: string) => Layer | undefined;
}

function useLayerManager(): UseLayerManagerResult
```

**Example:**

```tsx
import { useLayerManager } from 'annota';

function LayerPanel() {
  const layerManager = useLayerManager();

  const createTumorLayer = () => {
    layerManager.createLayer({
      id: 'tumor',
      name: 'Tumor Regions',
      visible: true,
      style: {
        fill: 'rgba(255, 0, 0, 0.3)',
        stroke: '#ff0000',
      },
    });
  };

  return (
    <div>
      {layerManager.layers.map(layer => (
        <div key={layer.id}>
          <input
            type="checkbox"
            checked={layer.visible}
            onChange={(e) =>
              layerManager.updateLayer(layer.id, {
                visible: e.target.checked,
              })
            }
          />
          {layer.name}
        </div>
      ))}
    </div>
  );
}
```

## useViewer

Get the OpenSeadragon viewer instance.

```typescript
function useViewer(): OpenSeadragon.Viewer | undefined
```

**Example:**

```tsx
const viewer = useViewer();
```

## useAnnotator

Get the Annota annotator instance.

```typescript
function useAnnotator(): AnnotatorInstance | undefined
```

**Example:**

```tsx
const annotator = useAnnotator();

// Access the annotation store directly
const allAnnotations = annotator.state.store.all();
```
