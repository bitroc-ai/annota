# TypeScript Types

Complete TypeScript type definitions for Annota.

## Core Types

### Annotation

```typescript
interface Annotation {
  id: string;
  shape: PointShape | RectangleShape | PolygonShape;
  properties?: Record<string, any>;
  style?: AnnotationStyle;
}
```

The main annotation type. Every annotation has:
- `id`: Unique identifier (string)
- `shape`: Geometry definition
- `properties`: Optional custom metadata
- `style`: Optional visual styling

### AnnotationStyle

```typescript
interface AnnotationStyle {
  fill?: string;          // Fill color (CSS color string)
  fillOpacity?: number;   // Fill opacity (0-1)
  stroke?: string;        // Stroke color (CSS color string)
  strokeWidth?: number;   // Stroke width in image coordinates
  strokeOpacity?: number; // Stroke opacity (0-1)
}
```

Visual styling for annotations. All properties are optional.

## Shape Types

All shape types share a common `bounds` property for spatial indexing.

### Shape Union Type

```typescript
type Shape =
  | PointShape
  | CircleShape
  | EllipseShape
  | RectangleShape
  | LineShape
  | PolygonShape
  | FreehandShape
  | MultiPolygonShape;
```

### PointShape

```typescript
interface PointShape {
  type: 'point';
  point: Point;
  bounds: Bounds;
}

interface Point {
  x: number;
  y: number;
}
```

A single point on the image.

**Example:**

```typescript
const pointShape: PointShape = {
  type: 'point',
  point: { x: 100, y: 200 },
  bounds: { minX: 100, minY: 200, maxX: 100, maxY: 200 },
};
```

### CircleShape

```typescript
interface CircleShape {
  type: 'circle';
  center: Point;
  radius: number;
  bounds: Bounds;
}
```

A circle defined by center point and radius.

**Example:**

```typescript
const circleShape: CircleShape = {
  type: 'circle',
  center: { x: 100, y: 100 },
  radius: 50,
  bounds: { minX: 50, minY: 50, maxX: 150, maxY: 150 },
};
```

### EllipseShape

```typescript
interface EllipseShape {
  type: 'ellipse';
  center: Point;
  radiusX: number;
  radiusY: number;
  rotation?: number;  // Rotation in degrees
  bounds: Bounds;
}
```

An ellipse with optional rotation.

**Example:**

```typescript
const ellipseShape: EllipseShape = {
  type: 'ellipse',
  center: { x: 100, y: 100 },
  radiusX: 80,
  radiusY: 50,
  rotation: 45,
  bounds: { minX: 20, minY: 50, maxX: 180, maxY: 150 },
};
```

### RectangleShape

```typescript
interface RectangleShape {
  type: 'rectangle';
  x: number;
  y: number;
  width: number;
  height: number;
  bounds: Bounds;
}
```

A rectangular region.

**Example:**

```typescript
const rectangleShape: RectangleShape = {
  type: 'rectangle',
  x: 100,
  y: 100,
  width: 200,
  height: 150,
  bounds: { minX: 100, minY: 100, maxX: 300, maxY: 250 },
};
```

### LineShape

```typescript
interface LineShape {
  type: 'line';
  points: [Point, Point];  // Start and end points
  bounds: Bounds;
}
```

A line segment between two points.

**Example:**

```typescript
const lineShape: LineShape = {
  type: 'line',
  points: [
    { x: 100, y: 100 },
    { x: 200, y: 200 },
  ],
  bounds: { minX: 100, minY: 100, maxX: 200, maxY: 200 },
};
```

### PolygonShape

```typescript
interface PolygonShape {
  type: 'polygon';
  points: Point[];
  bounds: Bounds;
}
```

A polygon defined by vertices.

**Example:**

```typescript
const polygonShape: PolygonShape = {
  type: 'polygon',
  points: [
    { x: 100, y: 100 },
    { x: 200, y: 100 },
    { x: 200, y: 200 },
    { x: 100, y: 200 },
  ],
  bounds: { minX: 100, minY: 100, maxX: 200, maxY: 200 },
};
```

### FreehandShape

```typescript
interface FreehandShape {
  type: 'freehand';
  points: Point[];
  bounds: Bounds;
}
```

A freehand drawing (similar to polygon but represents a drawn path).

**Example:**

```typescript
const freehandShape: FreehandShape = {
  type: 'freehand',
  points: [
    { x: 100, y: 100 },
    { x: 105, y: 102 },
    { x: 110, y: 105 },
    // ... many points
  ],
  bounds: { minX: 100, minY: 100, maxX: 200, maxY: 150 },
};
```

### MultiPolygonShape

```typescript
interface MultiPolygonShape {
  type: 'multipolygon';
  polygons: Point[][];
  bounds: Bounds;
}
```

Multiple polygons grouped as a single annotation (e.g., for annotations with holes).

**Example:**

```typescript
const multiPolygonShape: MultiPolygonShape = {
  type: 'multipolygon',
  polygons: [
    // Outer polygon
    [
      { x: 0, y: 0 },
      { x: 100, y: 0 },
      { x: 100, y: 100 },
      { x: 0, y: 100 },
    ],
    // Inner polygon (hole)
    [
      { x: 25, y: 25 },
      { x: 75, y: 25 },
      { x: 75, y: 75 },
      { x: 25, y: 75 },
    ],
  ],
  bounds: { minX: 0, minY: 0, maxX: 100, maxY: 100 },
};
```

### Bounds

```typescript
interface Bounds {
  minX: number;
  minY: number;
  maxX: number;
  maxY: number;
}
```

Bounding box for spatial queries and rendering optimization.

## Layer Types

### Layer

```typescript
interface Layer {
  id: string;
  name: string;
  visible: boolean;
  locked: boolean;
  opacity: number;   // 0-1
  zIndex: number;
  filter?: (annotation: Annotation) => boolean;
}
```

Layer definition with visibility, styling, and filtering controls.

### LayerConfig

```typescript
interface LayerConfig {
  id: string;
  name: string;
  visible?: boolean;   // Default: true
  locked?: boolean;    // Default: false
  opacity?: number;    // Default: 1
  zIndex?: number;     // Default: 0
  filter?: (annotation: Annotation) => boolean;
}
```

Configuration for creating new layers.

### MaskPolarity

```typescript
type MaskPolarity = 'positive' | 'negative';
```

Mask polarity for annotations loaded from mask files. Positive masks represent foreground, negative masks represent background.

## Event Types

### AnnotatorEvent

```typescript
type AnnotatorEvent =
  | 'createAnnotation'
  | 'updateAnnotation'
  | 'deleteAnnotation'
  | 'selectionChanged';
```

Event types emitted by the annotator.

### AnnotatorEventHandler

```typescript
type AnnotatorEventHandler = (data: any) => void;
```

Event handler function type.

## Tool Types

### ToolHandler

```typescript
interface ToolHandler {
  enable(): void;
  disable(): void;
  destroy(): void;
}
```

Base interface for annotation tools.

### ToolHandlerOptions

```typescript
interface ToolHandlerOptions {
  preventDefaultAction?: boolean;
  checkAnnotationHits?: boolean;
  annotationStyle?: AnnotationStyle;
  annotationProperties?: Record<string, unknown>;
}
```

Options for configuring tool behavior.

### ToolType

```typescript
type ToolType = 'pan' | 'point' | 'push' | 'move' | 'contour';
```

Built-in tool types.

### PushToolOptions

```typescript
interface PushToolOptions extends ToolHandlerOptions {
  radius?: number;       // Influence radius (default: 50)
  strength?: number;     // Push strength 0-1 (default: 0.5)
  showCursor?: boolean;  // Show cursor indicator (default: true)
}
```

Options for PushTool.

### ContourDetectOptions

```typescript
interface ContourDetectOptions extends ToolHandlerOptions {
  threshold?: number;        // Edge detection threshold
  minArea?: number;          // Minimum contour area
  maxArea?: number;          // Maximum contour area
  simplify?: number;         // Polygon simplification tolerance
}
```

Options for ContourTool.

### UseToolOptions

```typescript
interface UseToolOptions {
  viewer: OpenSeadragon.Viewer | undefined;
  handler: ToolHandler | null;
  enabled: boolean;
}
```

Options for the `useTool` hook.

## Hook Return Types

### UseLayerManagerResult

```typescript
interface UseLayerManagerResult {
  layers: Layer[];
  createLayer(config: LayerConfig): void;
  updateLayer(id: string, updates: Partial<Layer>): void;
  deleteLayer(id: string, deleteAnnotations?: boolean): void;
  getLayer(id: string): Layer | undefined;
}
```

Return type for `useLayerManager` hook.

### UseHistoryResult

```typescript
interface UseHistoryResult {
  canUndo: boolean;
  canRedo: boolean;
  undo: () => void;
  redo: () => void;
  clear: () => void;
}
```

Return type for `useHistory` hook.

### UsePopupResult

```typescript
interface UsePopupResult {
  annotation: Annotation | null;
  show: (annotationId: string) => void;
  hide: () => void;
  toggle: (annotationId: string) => void;
  updateProperties: (annotationId: string, properties: Record<string, unknown>) => void;
  updateStyle: (annotationId: string, style: Partial<AnnotationStyle>) => void;
  deleteAnnotation: (annotationId: string) => void;
}
```

Return type for `usePopup` hook.

### UseEditingResult

```typescript
interface UseEditingResult {
  editingAnnotation: Annotation | null;
  editingId: string | undefined;
  editMode: 'vertices' | undefined;
  startEditing: (annotationId: string, mode?: 'vertices') => void;
  stopEditing: () => void;
  isEditing: (annotationId: string) => boolean;
}
```

Return type for `useEditing` hook.

### UseContextMenuResult

```typescript
interface UseContextMenuResult {
  visible: boolean;
  position: { x: number; y: number };
  annotation: Annotation | null;
  show: (annotation: Annotation | null, x: number, y: number) => void;
  hide: () => void;
}
```

Return type for `useContextMenu` hook.

### UseViewerResult

```typescript
interface UseViewerResult {
  viewer: OpenSeadragon.Viewer | undefined;
  ready: boolean;
}
```

Return type for `useViewer` hook (extended version).

### UseImageLayerVisibilityResult

```typescript
interface UseImageLayerVisibilityResult {
  visible: boolean;
  setVisible: (visible: boolean) => void;
}
```

Return type for `useImageLayerVisibility` hook.

## Loader Types

### H5MaskLoaderOptions

```typescript
interface H5MaskLoaderOptions {
  color?: string;
  fillOpacity?: number;
  strokeWidth?: number;
  dataset?: string;
  properties?: Record<string, any>;
}
```

Options for `loadH5Masks` loader.

### H5CoordinateLoaderOptions

```typescript
interface H5CoordinateLoaderOptions {
  color?: string;
  fillOpacity?: number;
  strokeWidth?: number;
  properties?: Record<string, any>;
}
```

Options for `loadH5Coordinates` loader.

## Component Props

### AnnotaProviderProps

```typescript
interface AnnotaProviderProps {
  slideId?: string;
  children: React.ReactNode;
}
```

### AnnotaViewerProps

```typescript
interface ViewerProps {
  options: OpenSeadragon.Options;
  onViewerReady?: (viewer: OpenSeadragon.Viewer) => void;
  className?: string;
}
```

### AnnotatorProps

```typescript
interface AnnotatorProps {
  viewer: OpenSeadragon.Viewer | undefined;
  style?: (annotation: Annotation) => AnnotationStyle;
  children?: React.ReactNode;
}
```

### AnnotationEditorProps

```typescript
interface AnnotationEditorProps {
  viewer: OpenSeadragon.Viewer | undefined;
}
```

## Type Guards

### Shape Type Guards

```typescript
function isPointShape(shape: Shape): shape is PointShape {
  return shape.type === 'point';
}

function isRectangleShape(shape: Shape): shape is RectangleShape {
  return shape.type === 'rectangle';
}

function isPolygonShape(shape: Shape): shape is PolygonShape {
  return shape.type === 'polygon';
}
```

**Usage:**

```typescript
const annotation: Annotation = {...};

if (isPointShape(annotation.shape)) {
  // TypeScript knows annotation.shape is PointShape
  console.log(annotation.shape.point.x, annotation.shape.point.y);
}
```

## Utility Types

### Partial Annotation

For updates:

```typescript
type PartialAnnotation = Partial<Annotation>;

// Update only specific fields
annotator.updateAnnotation('ann-1', {
  properties: { type: 'tumor' },
} as PartialAnnotation);
```

### Annotation Without ID

For creating annotations (ID will be auto-generated):

```typescript
type AnnotationInput = Omit<Annotation, 'id'> & { id?: string };
```

## Next Steps

- [React Hooks](/api/hooks) - Hooks that use these types
- [Annotator Instance](/api/annotator) - API methods with type signatures
- [Components](/api/components) - Component props and types
